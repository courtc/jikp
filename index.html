<!DOCTYPE html>
<html>
	<head>
		<title>IK+ Revival</title>	
		
		<style>
			@font-face {
				font-family: "C64 Pro Mono";
				src: url("gfx/C64_Pro_Mono_v1.0-STYLE.ttf") format("truetype");
			}
			body {
				background-color:#000;
				margin:0 0 0 0;
				padding: 0 0 0 0;
				overflow: hidden;
				font: normal 24pt/32px "C64 Pro Mono", verdana, helvetica, sans-serif;
			}
		</style>
		
	</head>
	<body>
	
	
	<script>
        var anim_walk = [35,36,37,38,39,40];
        var anim_idle = [0];
        var anim_headbutt = [1,2,1];
        var anim_kick_high = [4,5,6];
        var anim_fall = [7,8,9,10,11,12,35,35,35,35];
        var anim_cartwheel = [21,22,23,24,25,26];
        var anim_jump = [13,14,14,14,13];
        var anim_jumpkick = [13,14,15,15,13];
        var anim_punch = [];
        var anim_kick = [];
        var anim_low_kick = [];
        var anim_sweep = [];
        var anim_block = [];
        var anim_splitkick = [];
        var anim_sit_punch = [];
        var anim_k = [];
        var anim_ki = [];
        var anim_demo = [0,0,0,0,21,22,23,24,25,26,35,35,1,2,1,35,4,5,6,35,35,0,0,0,0];

		var KEYCODE_SHIFT = 16;		//usefull keycode
		var KEYCODE_SPACE = 32;		//usefull keycode
		var KEYCODE_CTRL = 17;		//usefull keycode
		var KEYCODE_UP = 38;		//usefull keycode
		var KEYCODE_DOWN = 40;		//usefull keycode
		var KEYCODE_LEFT = 37;		//usefull keycode
		var KEYCODE_RIGHT = 39;		//usefull keycode
		var KEYCODE_W = 87;			//usefull keycode
		var KEYCODE_A = 65;			//usefull keycode
		var KEYCODE_S = 83;			//usefull keycode
		var KEYCODE_D = 68;        
		var KEYCODE_G = 71;        
		var KEYCODE_H = 72;        
		var KEYCODE_J = 74;        
		var KEYCODE_Y = 89;        
	
		function player( id, xpos, img, playerkeys )   // img , xpos, playerkeys 
        {
            this.x = xpos*scale;
            this.y = 100*scale;
			this.playerKeys = playerkeys;
            this.currentframe = 0;
            this.counter = 0;
            this.anim = anim_demo;
            this.health = 0;
            this.spriteSheet = img;
            this.frameX = 0;
            this.frameY = 0;
            this.spriteWidth = 0;
            this.spriteHeight = 0;
            this.step = function() {
                this.counter++;
                if(this.counter >= this.anim.length ) this.counter = 0;
                this.frameX = this.spriteWidth * parseInt(this.anim[this.counter] % 7);
                this.frameY = this.spriteHeight * parseInt(this.anim[this.counter] / 7);
            }
            this.initPlayer = function()
            {
                this.spriteWidth = parseInt(images[this.spriteSheet].width / 7);
                this.spriteHeight = parseInt(images[this.spriteSheet].height / 6);
                //numFrames = parseInt((images[spriteSheet].width / spriteWidth) *  (images[spriteSheet].width /spriteHeight)) - 2;
            }
			this.updatePlayer = function()
			{
				this.x = xpos*scale;
				this.y = 100*scale;
			}
			this.executeKey = function(keypress)
			{				
				for (var i=0; i<this.playerKeys.length; i++) {
					if (this.playerKeys[i] == keypress) {
						switch(i) {
							case 0:			// move left
								this.x = this.x - (3*scale);		// console.log('LEFT ' + img);
								break;
							case 1:			// move right
								this.x = this.x +3*scale;
								break;
							case 2:			// move up
								break;
							case 3:			// move down
								break;
							case 4:			// fire
								break;
						}
					}
				}
			}
        }
        // screen size variables
		var scale = 0;
		var SCREEN_WIDTH, SCREEN_HEIGHT;
			
		function screenUpdate() {
			SCREEN_WIDTH = window.innerWidth;
			SCREEN_HEIGHT = window.innerHeight;

			if (window.innerWidth / 320 < window.innerHeight / 200) {
				scale = window.innerWidth / 320;
			} else {
				scale = window.innerHeight / 200;		
			}
			
			canvas.width = SCREEN_WIDTH;
			canvas.height = SCREEN_HEIGHT;
			
			for (i = 0; i< players.length; i++){
				players[i].updatePlayer();
			}
		}
 		
  		var canvas = document.createElement('canvas');
  		var c = canvas.getContext('2d');
		
		var index=0, 
			numFrames = 30, 
			gameState = 0,
            spriteFrame = 0,
            frameCounter = 0,
            frameTime = 0,
            splashDelay = 5;

 		
 		 // Add our drawing canvas
  		document.body.appendChild(canvas); 

   		//load the images
        var images = {};
		images[0] = new Image();
		images[0].src = "gfx/ikplayer_blue.png";
        images[1] = new Image();
		images[1].src = "gfx/ikplayer_red.png";
        images[2] = new Image();
		images[2].src = "gfx/ikplayer_white.png";
        
		iBack = new Image();
		iBack.src = "gfx/ikback.png";
        iSplash = new Image();
		iSplash.src = "gfx/iksplash.png";
        
        var players = [		// id, x pos, imageref, assigned keys
			new player(0,0,0,[KEYCODE_LEFT, KEYCODE_RIGHT, KEYCODE_UP, KEYCODE_DOWN, KEYCODE_SHIFT]),
			new player(1,60,1,[KEYCODE_A, KEYCODE_D, KEYCODE_W, KEYCODE_S, KEYCODE_CTRL]),
			new player(2,120,2,[KEYCODE_G, KEYCODE_J, KEYCODE_Y, KEYCODE_H, KEYCODE_SPACE]),
			new player(3,180,1,[0]),
			new player(4,240,0,[0])
		];
		// wait until everything is loaded before we 
		// start the animation

		screenUpdate();		
		window.addEventListener("load", init);
		window.onresize = screenUpdate;
		window.onkeydown = handleKeyDown;
		window.onkeyup = handleKeyUp;		
		
		function init(){
			
			//we're ready for the loop
            for (i = 0; i< players.length; i++){
                players[i].initPlayer();
            }
            
			setInterval(loop, 1000 / 10);
		}
		
		function handleKeyDown(e) {
			if(!e){ var e = window.event; }
			for (i = 0; i< players.length; i++){
				players[i].executeKey(e.keyCode);
			}
		}
		
		function handleKeyUp(e) {
		
		}
    
	   	function input() {
        
            
        }
    
		function loop() {
            frameTime ++;
            frameCounter++;
            if(frameTime > splashDelay) gameState = 1;
                
			/*our big long list of arguments below equates to
				1: our image source
				2 - 5: the rectangle in the source image of what we want to draw
				6 - 9: the  rectangle of our canvas that we are drawing into
			*/
            switch(gameState)
            {
                case 0: //SPLASH
                    //DRAW SPLASH
                    c.drawImage(iSplash, 0, 0, iSplash.width, iSplash.height, 0, 0, iSplash.width*scale, iSplash.height*scale);
                    break;
                case 1: //DEMO MODE
                    //LOGIC
                    
                    
                    //DRAW
                    //c.clearRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);
                    c.drawImage(iBack, 0, 0, iBack.width, iBack.height, 0, 0, iBack.width*scale, iBack.height*scale);
                    
                    for (i = 0; i< players.length; i++){
                        players[i].step();
                        
                        c.drawImage(
							images[players[i].spriteSheet], players[i].frameX , players[i].frameY, players[i].spriteWidth, players[i].spriteHeight, players[i].x , players[i].y , players[i].spriteWidth*scale, players[i].spriteHeight*scale);
                    }
					c.fillStyle = "#fff";
					c.font = "" + 6*scale + "pt C64 Pro Mono";
					c.fillText("Hello World", (0*scale),(7*scale)+(25*scale));
					break;
					
                case 2: // GAME ON!
                    break;
					
                default:
                    break;
            }
			
			
		}
    	
	
   		
	</script>
	please load font!
	</body>
	
</html>
